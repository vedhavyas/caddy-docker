machine:
  services:
    - docker

dependencies:
  override:
    - docker run -v `pwd`:/$CIRCLE_PROJECT_REPONAME -w /$CIRCLE_PROJECT_REPONAME golang:latest bash -c "cd /$CIRCLE_PROJECT_REPONAME; ./build_caddy.sh"

test:
  override:
    - echo "Not running tests here anymore"

deployment:
  publish:
    branch: master
    commands:
      - docker build -t caddy:latest .